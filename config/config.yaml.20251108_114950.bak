# AnomalyGuard Central Configuration
# This file centralizes all configurable parameters for the system

# Database Connections
databases:
  clickhouse:
    host: airflow_clickhouse
    port: 8123
    database: analytics
    user: airflow
    password: clickhouse1234
    enabled: true

  postgres:
    host: postgres
    port: 5432
    database: airflow
    user: airflow
    password: airflow1234
    enabled: true

# Airflow Configuration
airflow:
  webserver_url: http://localhost:8080
  username: admin
  password: admin1234
  dags:
    training:
      name: train_ensemble_models
      schedule: "0 2 * * 0"  # Weekly Sunday 2 AM
      enabled: true
      params:
        training_window_days: 30
        min_samples: 1000
        validation_split: 0.2

    detection:
      name: ensemble_anomaly_detection
      schedule: "0 * * * *"  # Hourly
      enabled: true
      params:
        lookback_hours: 1
        batch_size: 1000

# Model Configuration
models:
  base_path: /opt/airflow/models

  isolation_forest:
    enabled: true
    params:
      n_estimators: 100
      contamination: 0.01
      max_samples: auto
      random_state: 42

  autoencoder:
    enabled: true
    params:
      encoding_dim: 10
      hidden_layers: [30, 20]
      epochs: 50
      batch_size: 32
      validation_split: 0.1
      early_stopping_patience: 5
      learning_rate: 0.001

# Ensemble Configuration
ensemble:
  weights:
    statistical: 0.20
    isolation_forest: 0.40
    autoencoder: 0.40

  thresholds:
    low: 30
    medium: 60
    high: 80
    critical: 90

  risk_levels:
    low:
      min_score: 0
      max_score: 30
      action: "allow"
      color: "#28a745"
    medium:
      min_score: 30
      max_score: 60
      action: "review"
      color: "#ffc107"
    high:
      min_score: 60
      max_score: 80
      action: "review"
      color: "#fd7e14"
    critical:
      min_score: 80
      max_score: 100
      action: "block"
      color: "#dc3545"

# Feature Engineering
features:
  total_count: 35
  normalization: "standard"
  scaler_path: /opt/airflow/models/scaler_params.json

  categories:
    basic:
      - amount
      - fee
      - hour_of_day
      - day_of_week
      - amount_log
      - fee_log
      - fee_ratio

    time:
      - hour_sin
      - hour_cos
      - day_sin
      - day_cos
      - is_weekend
      - is_night
      - is_business_hours

    user_behavior:
      - user_total_tx
      - user_avg_amount
      - user_std_amount
      - user_max_amount
      - user_total_volume
      - user_currencies
      - user_tx_types
      - user_account_age_days
      - user_days_since_last_tx
      - amount_vs_user_avg
      - amount_vs_user_max
      - amount_zscore

    address:
      - has_from_address
      - has_to_address
      - has_both_addresses
      - from_address_len
      - to_address_len

    statistical:
      - amount_rolling_mean
      - amount_rolling_std
      - fee_rolling_mean
      - fee_rolling_std

# Alerts and Notifications
alerts:
  enabled: true
  channels:
    email:
      enabled: false
      smtp_host: smtp.gmail.com
      smtp_port: 587
      sender: alerts@anomalyguard.com
      recipients:
        - admin@example.com
    slack:
      enabled: false
      webhook_url: ""
    telegram:
      enabled: false
      bot_token: ""
      chat_id: ""

# Docker Services
docker:
  services:
    - name: clickhouse
      container: airflow_clickhouse
      health_check: "clickhouse-client --query 'SELECT 1'"

    - name: postgres
      container: airflow_postgres
      health_check: "pg_isready -U airflow"

    - name: airflow-webserver
      container: airflow_webserver
      health_check: "curl -f http://localhost:8080/health"

    - name: airflow-scheduler
      container: airflow_scheduler
      health_check: "airflow jobs check --job-type SchedulerJob"

# Streamlit Dashboard
dashboard:
  title: "AnomalyGuard Control Center"
  port: 8501
  theme:
    primaryColor: "#1f77b4"
    backgroundColor: "#ffffff"
    secondaryBackgroundColor: "#f0f2f6"
    textColor: "#262730"

  refresh_intervals:
    live_feed: 5  # seconds
    metrics: 30
    services: 60

  page_config:
    layout: wide
    initial_sidebar_state: expanded

  pages:
    - name: "Dashboard"
      icon: "üìä"
      enabled: true

    - name: "Models"
      icon: "ü§ñ"
      enabled: true

    - name: "DAGs"
      icon: "‚öôÔ∏è"
      enabled: true

    - name: "Data"
      icon: "üíæ"
      enabled: true

    - name: "Anomalies"
      icon: "üîç"
      enabled: true

    - name: "Configuration"
      icon: "üéõÔ∏è"
      enabled: true

    - name: "Services"
      icon: "üê≥"
      enabled: true

    - name: "Analytics"
      icon: "üìà"
      enabled: true

# Data Management
data:
  import:
    batch_size: 500
    supported_formats:
      - csv
      - json
      - parquet

  export:
    max_rows: 100000
    supported_formats:
      - csv
      - json
      - excel
      - parquet

# System
system:
  timezone: UTC
  log_level: INFO
  max_log_size_mb: 100
  backup:
    enabled: true
    path: /opt/airflow/backups
    retention_days: 30